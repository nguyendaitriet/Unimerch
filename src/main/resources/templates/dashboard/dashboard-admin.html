<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <th:block th:replace="layout/head :: dashboard-head"/>
    <title th:text="#{dashboard.pageTitle}">Dashboard</title>
</head>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <th:block th:replace="layout/sidebar :: sidebar"/>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->
            <th:block th:replace="layout/topbar"/>
            <!-- End of Topbar -->

            <!-- Begin Page Content -->
            <div class="container-fluid">
                <div class="row">
                    <!-- User Filter-->
                    <div id="sticky-filter" class="col-3 col-md-2">
                        <div class="card shadow mb-4">
                            <!-- Card Header -->
                            <div id="sticky-filter-header"
                                 class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <a class="custom-card-title m-0 font-weight-bold text-primary text-decoration-none"
                                    th:href="@{'/dashboard/' + ${(group.id != 0) ? group.id : ''}}"
                                    th:text="${group.title}">Accounts</a>
                            </div>
                            <div class="input-group input-group-sm mt-2 filter-group">
                                <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="fas fa-filter"></i>
                                        </span>
                                </div>
                                <input id="dashboard-user-search" class="form-control" type="text"
                                       th:placeholder="#{dashboard.filterPlaceHolder}">
                            </div>

                            <div class="scrollbar-user bg-white mt-2 custom-scrollbar">
                                <ul id="filter-dashboard" class="list-group list-group-flush">
                                    <!-- User Items -->

                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="col-9 col-md-10">
                        <div class="card shadow mb-4">
                            <!-- Card Header -->
                            <ul class="card-header nav nav-tabs custom-nav" role="tablist">
                                <li class="nav-item">
                                    <a class="m-0 font-weight-bold text-primary nav-link active custom-card-title"
                                       data-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard"
                                       aria-selected="true" th:text="#{dashboard.tab.dashboard}">Dashboard</a>
                                </li>
                                <li class="nav-item">
                                    <a class="m-0 font-weight-bold text-primary nav-link custom-card-title"
                                       data-toggle="tab" href="#analytics" role="tab" aria-controls="analytics"
                                       aria-selected="false" th:text="#{dashboard.tab.analytics}">Analytics</a>
                                </li>
                                <li class="nav-item">
                                    <a class="m-0 font-weight-bold text-primary nav-link custom-card-title"
                                       data-toggle="tab" href="#accountDie" role="tab" aria-controls="accountDie"
                                       aria-selected="false" th:text="#{dashboard.tab.accountDie}">Account Die</a>
                                </li>
                            </ul>

                            <div class="card-body tab-content">
                                <!-- Card Body -- Dashboard -->
                                <div class="tab-pane fade show active" id="dashboard" role="tabpanel"
                                     aria-labelledby="dashboard-tab">

                                    <div class="row flex-md-row-reverse">
                                        <!-- Chart -->
                                        <div class="col-lg-8 col-md-12 mb-4">
                                            <div class="row" id="chartHolder" style="height:380px; width:100%;"></div>
                                            <div class="row mt-4 text-center justify-content-center small">
                                                    <span class="mr-4">
                                                        <i class="fas fa-square" style="color: #41b2e6"></i>
                                                        <br th:text="#{dashboard.chart.legend.royalties}">
                                                    </span>
                                                <span class="mr-4">
                                                        <i class="fas fa-square" style="color: #f9bd03"></i>
                                                    <br th:text="#{dashboard.chart.legend.numberSold}">
                                                    </span>
                                            </div>
                                        </div>

                                        <!-- Today's sale -->
                                        <div class="col-lg-4 col-md-12 my-4 mt-md-5">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2">
                                                        <div class="col mr-2">
                                                            <div class="text-center font-weight-bold text-primary text-uppercase">
                                                                Today's Sale
                                                                <br>
                                                                <span id="todayDate"></span>
                                                            </div>

                                                            <hr class="sidebar-divider my-2">

                                                            <div id="todayPurchased"
                                                                 class="h2 text-center mb-0 font-weight-bold text-gray-800">
                                                                0
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row mt-1 no-gutters d-flex justify-content-between">
                                                        <div id="todayRoyalties">
                                                            0
                                                        </div>
                                                        <div>
                                                            Royalties
                                                        </div>
                                                    </div>
                                                    <div class="row mt-1 no-gutters d-flex justify-content-between">
                                                        <div>
                                                            <span id="todaySold">0</span> - <span
                                                                id="todayCancelled">0</span>
                                                        </div>
                                                        <div>
                                                            Sold-Cancelled
                                                        </div>
                                                    </div>
                                                    <div class="row mt-1 no-gutters d-flex justify-content-between">
                                                        <div id="todayReturned">
                                                            0
                                                        </div>
                                                        <div>
                                                            Returned
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row justify-content-center">
                                        <!-- 1st card sale -->
                                        <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2 custom-card-header">
                                                        <div class="col mr-2">
                                                            <div class="h6 text-center font-weight-bold text-primary text-uppercase">
                                                                All Times
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr class="sidebar-divider my-2">

                                                    <div class="row">
                                                        <div class="col-6 d-flex flex-row justify-content-center align-items-center">
                                                            <div id="allTimePurchased"
                                                                 class="h3 mb-0 text-gray-800 font-weight-bold">
                                                                0
                                                            </div>
                                                        </div>

                                                        <div class="col-6">
                                                            <div id="allTimeRoyalties"
                                                                 class="row mt-1 no-gutters d-flex justify-content-end">
                                                                0
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                <span id="allTimeSold">0</span> - <span
                                                                    id="allTimeCancelled">0</span>
                                                            </div>
                                                            <div id="allTimeReturned"
                                                                 class="row mt-1 no-gutters d-flex justify-content-end">
                                                                0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 2nd card sale -->
                                        <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2 custom-card-header">
                                                        <div class="col mr-2">
                                                            <div class="h6 text-center font-weight-bold text-primary text-uppercase">
                                                                Yesterday
                                                                <br>
                                                                <span id="yesterdayDate"></span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr class="sidebar-divider my-2">

                                                    <div class="row">
                                                        <div class="col-6 d-flex flex-row justify-content-center align-items-center">
                                                            <div id="yesterdayPurchased"
                                                                 class="h3 mb-0 text-gray-800 font-weight-bold">
                                                                0
                                                            </div>
                                                        </div>

                                                        <div class="col-6">
                                                            <div id="yesterdayRoyalties"
                                                                 class="row mt-1 no-gutters d-flex justify-content-end">
                                                                0
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                <span id="yesterdaySold">0</span> - <span
                                                                    id="yesterdayCancelled">0</span>
                                                            </div>
                                                            <div id="yesterdayReturned"
                                                                 class="row mt-1 no-gutters d-flex justify-content-end">
                                                                0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 3rd card sale -->
                                        <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2 custom-card-header">
                                                        <div class="col mr-2">
                                                            <div class="h6 text-center font-weight-bold text-primary text-uppercase">
                                                                Last 7 Days
                                                                <br>
                                                                <span id="lastSevenDaysDate"></span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr class="sidebar-divider my-2">

                                                    <div class="row">
                                                        <div class="col-6 d-flex flex-row justify-content-center align-items-center">
                                                            <div id="lastSevenDaysPurchased"
                                                                 class="h3 mb-0 text-gray-800 font-weight-bold">
                                                                0
                                                            </div>
                                                        </div>

                                                        <div class="col-6">
                                                            <div id="lastSevenDaysRoyalties"
                                                                 class="row mt-1 no-gutters d-flex justify-content-end">
                                                                0
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                <span id="lastSevenDaysSold">0</span> - <span
                                                                    id="lastSevenDaysCancelled">0</span>
                                                            </div>
                                                            <div id="lastSevenDaysReturned"
                                                                 class="row mt-1 no-gutters d-flex justify-content-end">
                                                                0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 4th card sale -->
                                        <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2 custom-card-header">
                                                        <div class="col mr-2">
                                                            <div class="h6 text-center font-weight-bold text-primary text-uppercase">
                                                                This Month
                                                                <br>
                                                                <span id="thisMonthDate"></span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr class="sidebar-divider my-2">

                                                    <div class="row">
                                                        <div class="col-6 d-flex flex-row justify-content-center align-items-center">
                                                            <div id="thisMonthPurchased"
                                                                 class="h3 mb-0 text-gray-800 font-weight-bold">
                                                                0
                                                            </div>
                                                        </div>

                                                        <div class="col-6">
                                                            <div id="thisMonthRoyalties"
                                                                 class="row mt-1 no-gutters d-flex justify-content-end">
                                                                0
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                <span id="thisMonthSold">0</span> - <span
                                                                    id="thisMonthCancelled">0</span>
                                                            </div>
                                                            <div id="thisMonthReturned"
                                                                 class="row mt-1 no-gutters d-flex justify-content-end">
                                                                0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 5th card sale -->
                                        <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2 custom-card-header">
                                                        <div class="col mr-2">
                                                            <div class="h6 text-center font-weight-bold text-primary text-uppercase">
                                                                Previous Month
                                                                <br>
                                                                <span id="previousMonthDate"></span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr class="sidebar-divider my-2">

                                                    <div class="row">
                                                        <div class="col-6 d-flex flex-row justify-content-center align-items-center">
                                                            <div id="previousMonthPurchased"
                                                                 class="h3 mb-0 text-gray-800 font-weight-bold">
                                                                0
                                                            </div>
                                                        </div>

                                                        <div class="col-6">
                                                            <div id="previousMonthRoyalties"
                                                                 class="row mt-1 no-gutters d-flex justify-content-end">
                                                                0
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                <span id="previousMonthSold">0</span> - <span
                                                                    id="previousMonthCancelled">0</span>
                                                            </div>
                                                            <div id="previousMonthReturned"
                                                                 class="row mt-1 no-gutters d-flex justify-content-end">
                                                                0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <!-- Table Orders -->
                                    <ul class="card-header nav nav-tabs custom-nav" role="tablist">
                                        <li class="nav-item">
                                            <a class="m-0 font-weight-bold text-primary nav-link active custom-card-title"
                                               data-toggle="tab" href="#today" role="tab" aria-controls="today"
                                               aria-selected="true" th:text="#{dashboard.tab.today}" id="todayLink">
                                                Today
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="m-0 font-weight-bold text-primary nav-link custom-card-title"
                                               data-toggle="tab" href="#thirtyday" role="tab" aria-controls="thirtyday"
                                               aria-selected="false" th:text="#{dashboard.tab.thirtyDays}"
                                               id="thirtyDaysLink">
                                                30 Days
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="m-0 font-weight-bold text-primary nav-link custom-card-title"
                                               data-toggle="tab" href="#thismonth" role="tab" aria-controls="thismonth"
                                               aria-selected="false" th:text="#{dashboard.tab.thisMonth}"
                                               id="thisMonthLink">
                                                This month
                                            </a>
                                        </li>
                                    </ul>

                                    <div class="card-body tab-content">
                                        <!-- Table - Today -->
                                        <div class="tab-pane fade show active" id="today" role="tabpanel"
                                             aria-labelledby="today-tab">
                                            <table class="table table-striped table-bordered dt-responsive"
                                                   style="width: 100%;"
                                                   id="tableTodaySold">
                                                <thead>
                                                <tr class="text-dark">
                                                    <th>Sold</th>
                                                    <th>Product</th>
                                                    <th>Royalties</th>
                                                    <th>Price</th>
                                                    <th>Username</th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                        <!-- Table - 30 Days -->
                                        <div class="tab-pane fade show" id="thirtyday" role="tabpanel"
                                             aria-labelledby="thirtyday-tab">
                                            <table class="table table-striped table-bordered dt-responsive"
                                                   style="width: 100%;"
                                                   id="table30DaysSold">
                                                <thead>
                                                <tr class="text-dark">
                                                    <th>Sold</th>
                                                    <th>Product</th>
                                                    <th>Royalties</th>
                                                    <th>Price</th>
                                                    <th>Username</th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                        <!-- Table - This month -->
                                        <div class="tab-pane fade show" id="thismonth" role="tabpanel"
                                             aria-labelledby="thismonth-tab">
                                            <table id="tableThisMonthSold"
                                                   class="table table-striped table-bordered dt-responsive"
                                                   style="width: 100%;">
                                                <thead>
                                                <tr class="text-dark">
                                                    <th>Sold</th>
                                                    <th>Product</th>
                                                    <th>Royalties</th>
                                                    <th>Price</th>
                                                    <th>Username</th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- Card Body -- Analytics -->
                                <div class="tab-pane fade" id="analytics" role="tabpanel"
                                     aria-labelledby="analytics-tab">
                                    <table id="table-analytics"
                                           style="width: 100%;"
                                           class="table table-striped table-bordered dt-responsive nowrap">
                                        <thead>
                                        <tr class="text-dark">
                                            <th style="visibility: hidden">Id</th>
                                            <th>User</th>
                                            <th>Published</th>
                                            <th>Tier</th>
                                            <th>Slot Remaining</th>
                                            <th>Slot Total</th>
                                            <th>Reject</th>
                                            <th>Remove</th>
                                            <th>Note</th>
                                        </tr>
                                        </thead>
                                    </table>
                                </div>

                                <!-- Card Body -- Account Die -->
                                <div class="tab-pane fade" id="accountDie" role="tabpanel"
                                     aria-labelledby="accountDie-tab">
                                    <table id="table-account-die"
                                           style="width: 100%;"
                                           class="table table-striped table-bordered dt-responsive">
                                        <thead>
                                        <tr class="text-dark">
                                            <th style="visibility: hidden">Id</th>
                                            <th>#</th>
                                            <th>Username</th>
                                            <th>Last Update</th>
                                            <th>Account Status</th>
                                        </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <th:block th:replace="layout/footer :: footer"/>
        <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>

<th:block th:replace="layout/modals-dashboard :: add-note"/>

<th:block th:replace="layout/script :: script-dashboard"/>

<th:block th:replace="layout/texts :: texts"/>

<script>

    let currentGrpId = window.location.pathname.split('/')[2];

    let page = {
        urls: {
            findAllAmznAccountFilter: CommonApp.BASE_URL_AMZN_ACCOUNT + "/findAllFilter",
            findAmznAccInGrpFilter: CommonApp.BASE_URL_GROUP + "/findInGrpFilter/",

            findAnalyticsAll: CommonApp.BASE_URL_AMZN_ACCOUNT + "/analytics-all",
            findAnalyticsByGroupId: CommonApp.BASE_URL_AMZN_ACCOUNT + "/analytics-grp/",
            findAnalyticsByUserId: CommonApp.BASE_URL_AMZN_ACCOUNT + "/analytics-acc/",
            addNote: CommonApp.BASE_URL_AMZN_ACCOUNT + "/analytics-note/",

            findAccountDieAll: CommonApp.BASE_URL_AMZN_ACCOUNT + "/die-all",
            findAccountDieByGroupId: CommonApp.BASE_URL_AMZN_ACCOUNT + "/die-grp/",

            findCardsAll: CommonApp.BASE_URL_ORDER + "/card-all",
            findCardsByGroupId: CommonApp.BASE_URL_ORDER + "/card-grp/",
            findCardsByAmznId: CommonApp.BASE_URL_ORDER + "/card-acc/",
            findChartAll: CommonApp.BASE_URL_ORDER + "/chart-all",
            findChartByGroupId: CommonApp.BASE_URL_ORDER + "/chart-grp/",
            findChartByUserId: CommonApp.BASE_URL_ORDER + "/chart-acc/",

            findAllTodaySoldAllAmznAcc: CommonApp.BASE_URL_PRODUCT + "/findAllTodaySoldAllAmznAcc",
            findAllLast30DaysSoldAllAmznAcc: CommonApp.BASE_URL_PRODUCT + "/findAllLast30DaysSoldAllAmznAcc",
            findAllThisMonthSoldAllAmznAcc: CommonApp.BASE_URL_PRODUCT + "/findAllThisMonthSoldAllAmznAcc",

            findAllTodaySoldInGroup: CommonApp.BASE_URL_PRODUCT + "/findAllTodaySoldInGroup/",
            findAllLast30DaysSoldInGroup: CommonApp.BASE_URL_PRODUCT + "/findAllLast30DaysSoldInGroup/",
            findAllThisMonthSoldInGroup: CommonApp.BASE_URL_PRODUCT + "/findAllThisMonthSoldInGroup/",

            findAllTodaySoldEveryAmznAcc: CommonApp.BASE_URL_PRODUCT + "/findAllTodaySoldEveryAmznAcc/",
            findAllLast30DaysSoldEveryAmznAcc: CommonApp.BASE_URL_PRODUCT + "/findAllLast30DaysSoldEveryAmznAcc/",
            findAllThisMonthSoldEveryAmznAcc: CommonApp.BASE_URL_PRODUCT + "/findAllThisMonthSoldEveryAmznAcc/",
        },
        element: {},
        commands: {},
        dialogs: {
            element: {},
            alertDanger: {},
            inputError: {}
        }
    }

    page.element.tableTodaySold = $("#tableTodaySold");
    page.element.table30DaysSold = $("#table30DaysSold");
    page.element.tableThisMonthSold = $("#tableThisMonthSold");
    page.element.tableAnalytics = $("#table-analytics");
    page.element.tableAccountDie = $("#table-account-die");

    page.element.todayLink = $("#todayLink");
    page.element.thirtyDaysLink = $("#thirtyDaysLink");
    page.element.thisMonthLink = $("#thisMonthLink");

    page.dialogs.element.todayDate = $("#todayDate");
    page.dialogs.element.todayPurchased = $("#todayPurchased");
    page.dialogs.element.todaySold = $("#todaySold");
    page.dialogs.element.todayCancelled = $("#todayCancelled");
    page.dialogs.element.todayReturned = $("#todayReturned");
    page.dialogs.element.todayRoyalties = $("#todayRoyalties");

    page.dialogs.element.allTimePurchased = $("#allTimePurchased");
    page.dialogs.element.allTimeSold = $("#allTimeSold");
    page.dialogs.element.allTimeCancelled = $("#allTimeCancelled");
    page.dialogs.element.allTimeReturned = $("#allTimeReturned");
    page.dialogs.element.allTimeRoyalties = $("#allTimeRoyalties");

    page.dialogs.element.yesterdayDate = $("#yesterdayDate");
    page.dialogs.element.yesterdayPurchased = $("#yesterdayPurchased");
    page.dialogs.element.yesterdaySold = $("#yesterdaySold");
    page.dialogs.element.yesterdayCancelled = $("#yesterdayCancelled");
    page.dialogs.element.yesterdayReturned = $("#yesterdayReturned");
    page.dialogs.element.yesterdayRoyalties = $("#yesterdayRoyalties");

    page.dialogs.element.lastSevenDaysDate = $("#lastSevenDaysDate");
    page.dialogs.element.lastSevenDaysPurchased = $("#lastSevenDaysPurchased");
    page.dialogs.element.lastSevenDaysSold = $("#lastSevenDaysSold");
    page.dialogs.element.lastSevenDaysCancelled = $("#lastSevenDaysCancelled");
    page.dialogs.element.lastSevenDaysReturned = $("#lastSevenDaysReturned");
    page.dialogs.element.lastSevenDaysRoyalties = $("#lastSevenDaysRoyalties");

    page.dialogs.element.thisMonthDate = $("#thisMonthDate");
    page.dialogs.element.thisMonthPurchased = $("#thisMonthPurchased");
    page.dialogs.element.thisMonthSold = $("#thisMonthSold");
    page.dialogs.element.thisMonthCancelled = $("#thisMonthCancelled");
    page.dialogs.element.thisMonthReturned = $("#thisMonthReturned");
    page.dialogs.element.thisMonthRoyalties = $("#thisMonthRoyalties");

    page.dialogs.element.previousMonthDate = $("#previousMonthDate");
    page.dialogs.element.previousMonthPurchased = $("#previousMonthPurchased");
    page.dialogs.element.previousMonthSold = $("#previousMonthSold");
    page.dialogs.element.previousMonthCancelled = $("#previousMonthCancelled");
    page.dialogs.element.previousMonthReturned = $("#previousMonthReturned");
    page.dialogs.element.previousMonthRoyalties = $("#previousMonthRoyalties");

    page.dialogs.element.mdAddNote = $('#mdAddNote');
    page.dialogs.element.frmAddNote = $('#frmAddNote');
    page.dialogs.element.noteArea = $('#addNoteArea');
    page.dialogs.element.btnSaveNote = $('#btnSaveNote');

    page.commands.initTodaySoldTable = () => {
        let todaySoldTable = page.element.tableTodaySold.DataTable({
            ajax: {
                contentType: 'application/json',
                url: '/assets/json/data.json',
                dataSrc: ''
            },
            pagingType: 'simple_numbers',
            columns: [
                {data: 'quantitySold'},
                {data: 'productName'},
                {data: 'royalties'},
                {data: 'price'},
                {data: 'amznAccUsername'},
            ],
            columnDefs: [
                {
                    targets: 1,
                    render: (data, type, row) =>
                        `<a href='https://www.amazon.com/dp/${row.asin}' title='${btnManage}'target='_blank'>
                            ${row.productName}
                        </a>`
                },
                {
                    targets: 0,
                    className: "text-dark",
                },
            ],
            language: {
                search: `<i class="fas fa-search text-primary"></i> `,
                paginate: {
                    previous: `<i class="fas fa-angle-left"></i>`,
                    next: `<i class="fas fa-angle-right"></i>`
                },
                aria: {
                    paginate: {
                        previous: 'Previous',
                        next: 'Next'
                    }
                },
                emptyTable: `${noDataInTable}`
            },
            dom: '<"row mb-2"<"col"l><"col"f>>rtp'
        });

        todaySoldTable.order([0, "desc"]).draw();
    }

    page.commands.init30DaysSoldTable = () => {
        let thirtyDaysSoldTable = page.element.table30DaysSold.DataTable({
            ajax: {
                contentType: 'application/json',
                url: '/assets/json/data.json',
                dataSrc: ''
            },
            pagingType: 'simple_numbers',
            columns: [
                {data: 'quantitySold'},
                {data: 'productName'},
                {data: 'royalties'},
                {data: 'price'},
                {data: 'amznAccUsername'},
            ],
            columnDefs: [
                {
                    targets: 1,
                    render: (data, type, row) =>
                        `<a href='https://www.amazon.com/dp/${row.asin}' title='${btnManage}' target='_blank'>
                            ${row.productName}
                        </a>`
                },
                {
                    targets: 0,
                    className: "text-dark"
                },
            ],
            language: {
                search: `<i class="fas fa-search text-primary"></i> `,
                paginate: {
                    previous: `<i class="fas fa-angle-left"></i>`,
                    next: `<i class="fas fa-angle-right"></i>`
                },
                aria: {
                    paginate: {
                        previous: 'Previous',
                        next: 'Next'
                    }
                },
                emptyTable: `${noDataInTable}`
            },
            dom: '<"row mb-2"<"col"l><"col"f>>rtp'
        });

        thirtyDaysSoldTable.order([0, "desc"]).draw();
    }

    page.commands.initThisMonthSoldTable = () => {
        let thisMonthSoldTable = page.element.tableThisMonthSold.DataTable({
            ajax: {
                contentType: 'application/json',
                url: '/assets/json/data.json',
                dataSrc: ''
            },
            pagingType: 'simple_numbers',
            columns: [
                {data: 'quantitySold'},
                {data: 'productName'},
                {data: 'royalties'},
                {data: 'price'},
                {data: 'amznAccUsername'},
            ],
            columnDefs: [
                {
                    targets: 1,
                    render: (data, type, row) =>
                        `<a href='https://www.amazon.com/dp/${row.asin}' title='${btnManage}' target='_blank'>
                            ${row.productName}
                        </a>`
                },
                {
                    targets: 0,
                    className: "text-dark"
                },
            ],
            language: {
                search: `<i class="fas fa-search text-primary"></i> `,
                paginate: {
                    previous: `<i class="fas fa-angle-left"></i>`,
                    next: `<i class="fas fa-angle-right"></i>`
                },
                aria: {
                    paginate: {
                        previous: 'Previous',
                        next: 'Next'
                    }
                },
                emptyTable: `${noDataInTable}`
            },
            dom: '<"row mb-2"<"col"l><"col"f>>rtp'
        });

        thisMonthSoldTable.order([0, "desc"]).draw();
    }

    page.commands.initAnalyticsTable = () => {
        let analyticsTable = page.element.tableAnalytics.DataTable({
            ajax: {
                contentType: 'application/json',
                url: '/assets/json/data.json',
                dataSrc: ''
            },
            pagingType: 'simple_numbers',
            columns: [
                {data: 'id'},
                {data: 'username'},
                {data: 'published'},
                {data: 'tier'},
                {data: 'slotRemaining'},
                {data: 'slotTotal'},
                {data: 'reject'},
                {data: 'remove'},
                {data: 'note'}
            ],
            columnDefs: [
                {
                    targets: 0,
                    visible: false
                },
                {
                    targets: [1, 2, 3, 4, 5, 6],
                    type: 'natural'
                },
                {
                    targets: [2, 3, 4, 5, 6, 7],
                    className: 'text-right'
                },
                {
                    targets: -1,
                    className: 'text-center add-note',
                    orderable: false,
                    render: (data, type, row) => {
                        if (data === null)
                            return `<i class="fas fa-pen-fancy"></i>`;
                        return (data.length > 6) ? (data.substr(0, 6) + "...") : data
                    }
                }
            ],
            language: {
                search: `<i class="fas fa-search text-primary"></i> `,
                paginate: {
                    previous: `<i class="fas fa-angle-left"></i>`,
                    next: `<i class="fas fa-angle-right"></i>`
                },
                aria: {
                    paginate: {
                        previous: 'Previous',
                        next: 'Next'
                    }
                },
                emptyTable: `${noDataInTable}`
            },
            pageLength: 10,
            lengthChange: false,
            dom: '<"text-right mb-2"f>rtp'
        });

        let currentAmznUser = new AmznUser();
        let currentRowDOM;
        let currentRow;

        page.element.tableAnalytics.on('click', '.add-note', function () {
            currentRowDOM = $(this).parents('tr');

            if (currentRowDOM.hasClass('child'))
                currentRowDOM = currentRowDOM.prev();

            currentRow = analyticsTable.row(currentRowDOM);
            currentAmznUser = currentRow.data();

            page.dialogs.element.noteArea.val(currentAmznUser.note);

            page.dialogs.element.mdAddNote.modal('show');
        });

        page.dialogs.element.btnSaveNote.on('click', function () {
            page.dialogs.element.frmAddNote.submit();
        })

        page.dialogs.element.frmAddNote.validate({
            rules: {
                note: {
                    maxlength: 50
                }
            },
            messages: {
                note: {
                    maxlength: validNote
                }
            },
            submitHandler: function () {
                page.commands.doAddNote(currentAmznUser, currentRow);
            }
        })
    }

    page.commands.doAddNote = (currentAmznUser, currentRow) => {
        let note = page.dialogs.element.noteArea.val();
        $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "POST",
            "url": page.urls.addNote + currentAmznUser.id,
            "data": note
        })
            .done(() => {
                let tableAnalytics = page.element.tableAnalytics.DataTable();

                tableAnalytics.row(currentRow).data({
                    'id': currentAmznUser.id,
                    'username': currentAmznUser.username,
                    'published': currentAmznUser.published,
                    'tier': currentAmznUser.tier,
                    'slotRemaining': currentAmznUser.slotRemaining,
                    'slotTotal': currentAmznUser.slotTotal,
                    'reject': currentAmznUser.reject,
                    'remove': currentAmznUser.remove,
                    'note': note
                })
                    .draw('full-hold');

                page.dialogs.element.frmAddNote[0].reset();
                page.dialogs.element.mdAddNote.modal("hide");

                CommonApp.SweetAlert.showSuccessAlert(SUCCESS_UPDATED);
            })
            .fail((jqXHR) => {
                DBApp.handleFailedTasks(jqXHR);
            })
    }

    page.commands.initAccountDieTable = () => {
        let accountDieTable = page.element.tableAccountDie.DataTable({
            ajax: {
                contentType: 'application/json',
                url: '/assets/json/data.json',
                dataSrc: ''
            },
            pagingType: 'simple_numbers',
            columns: [
                {data: 'id'},
                {data: 'no'},
                {data: 'username'},
                {data: 'lastUpdate'},
                {data: 'accountStatus'}
            ],
            columnDefs: [
                {
                    targets: 0,
                    visible: false
                },
                {
                    targets: 1,
                    className: 'text-center'
                },
                {
                    targets: [1, 2],
                    type: 'natural'
                },
                {
                    targets: -1,
                    className: 'text-center',
                    orderable: false
                }
            ],
            language: {
                search: `<i class="fas fa-search text-primary"></i> `,
                paginate: {
                    previous: `<i class="fas fa-angle-left"></i>`,
                    next: `<i class="fas fa-angle-right"></i>`
                },
                aria: {
                    paginate: {
                        previous: 'Previous',
                        next: 'Next'
                    }
                },
                emptyTable: `${noDataInTable}`
            },
            pageLength: 10,
            lengthChange: false,
            dom: '<"text-right mb-2"f>rtp'
        });
    }

    $(document).ready(function () {
        DBApp.handleGroupsFilterSidebar();

        page.commands.handleContentDashboard(currentGrpId);
        page.commands.initTodaySoldTable();
        page.commands.init30DaysSoldTable();
        page.commands.initThisMonthSoldTable();
        page.commands.initAnalyticsTable();
        page.commands.initAccountDieTable();
    })

    //sticky Filter
    var stickyFilter = $("#sticky-filter");

    var stickyFilterHeader = $("#sticky-filter-header").height();

    $(window).scroll(function () {
        // console.log('window scrolltop: ' + $(this).scrollTop());
        if ($(this).scrollTop() > stickyFilterHeader + 125) {
            stickyFilter.addClass("navScrolled");
        } else {
            stickyFilter.removeClass("navScrolled");
        }
    });

    function getProductSoldDataForEachAmznAcc(amznAccId) {
        page.element.tableTodaySold.DataTable().ajax.url(page.urls.findAllTodaySoldEveryAmznAcc + amznAccId).load();
        page.element.table30DaysSold.DataTable().ajax.url(page.urls.findAllLast30DaysSoldEveryAmznAcc + amznAccId).load();
        page.element.tableThisMonthSold.DataTable().ajax.url(page.urls.findAllThisMonthSoldEveryAmznAcc + amznAccId).load();

    }

    /** chart */
    var chartData;
    var layoutStr;

    function chartReadyHandler(id) {
        $('#' + id)[0].setLayout(layoutStr);
        $('#' + id)[0].setData(chartData);
    }

    var chartVars = "KoolOnLoadCallFunction=chartReadyHandler";

    function formatAxis(id, value) {
        return DBApp.fmtNumWMetricSuffix(value);
    }

    page.commands.getChart = (url) => {
        $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "GET",
            "url": url
        })
            .done((chart) => {
                chartData = chart.columns;

                layoutStr =
                    `<KoolChart backgroundColor="#FFFFFF"  borderStyle="none">'
                    +'<Options>'
                        +'<Caption text="${chartCaption}" fontSize="20"/>'
                        +'<SubCaption text="Royalties $" textAlign="left" height="0" fontSize="15"/>'
                        +'<SubCaption text="Sold" textAlign="right" fontSize="15"/>'
                        +'<SubCaption/>'
                    +'</Options>'

                    +'<NumberFormatter id="numfmt" useThousandsSeparator="true"/>'

                    +'<Combination2DChart showDataTips="true">'
                        +'<horizontalAxis>'
                            +'<CategoryAxis categoryField="date"/>'
                        +'</horizontalAxis>'

                        +'<verticalAxis>'
                            +'<LinearAxis id="vAxis1" labelJsFunction="formatAxis" maximum="${chart.maxRoyaltiesAxis}"/>'
                        +'</verticalAxis>'

                        +'<series>'
                            +'<Column2DSeries labelPosition="none" yField="royalties" displayName="Royalties" columnWidthRatio="0.54">'
                                +'<fill>'
                                    +'<SolidColor color="#41b2e6"/>'
                                +'</fill>'
                                +'<showDataEffect>'
                                    +'<SeriesInterpolate/>'
                                +'</showDataEffect>'
                            +'</Column2DSeries>'

                            +'<Line2DSeries radius="6" yField="sold" displayName="Sold" itemRenderer="CircleItemRenderer">'
                                +'<verticalAxis>'
                                    +'<LinearAxis id="vAxis2" labelJsFunction="formatAxis" maximum="${chart.maxSoldAxis}"/>'
                                +'</verticalAxis>'
                                +'<showDataEffect>'
                                    +'<SeriesInterpolate/>'
                                +'</showDataEffect>'
                                +'<lineStroke>'
                                    +'<Stroke color="#f9bd03" weight="4"/>'
                                +'</lineStroke>'
                                +'<stroke>'
                                    +'<Stroke color="#f9bd03" weight="3"/>'
                                +'</stroke>'
                            +'</Line2DSeries>'
                        +'</series>'

                        +'<verticalAxisRenderers>'
                            +'<Axis2DRenderer axis="{vAxis1}" showLine="false"/>'
                            +'<Axis2DRenderer axis="{vAxis2}" showLine="false"/>'
                        +'</verticalAxisRenderers>'
                    +'</Combination2DChart>'
                +'</KoolChart>`;

                KoolChart.create("chart1", "chartHolder", chartVars, "100%", "100%");

            })
            .fail((jqXHR) => {
                DBApp.handleFailedTasks(jqXHR);
            })
    }

    page.commands.getCards = (url) => {
        $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "GET",
            "url": url
        })
            .done((cards) => {
                page.dialogs.element.todayDate.text(cards.today.date);
                page.dialogs.element.todayPurchased
                    .text(DBApp.fmtNumComma(cards.today.purchased));
                page.dialogs.element.todaySold
                    .text(DBApp.fmtNumComma(cards.today.sold));
                page.dialogs.element.todayCancelled
                    .text(DBApp.fmtNumComma(cards.today.cancelled));
                page.dialogs.element.todayReturned
                    .text(DBApp.fmtNumComma(cards.today.returned));
                page.dialogs.element.todayRoyalties
                    .text('$' + DBApp.fmtNumComma(cards.today.royalties));

                page.dialogs.element.allTimePurchased
                    .text(DBApp.fmtNumComma(cards.allTime.purchased));
                page.dialogs.element.allTimeSold
                    .text(DBApp.fmtNumComma(cards.allTime.sold));
                page.dialogs.element.allTimeCancelled
                    .text(DBApp.fmtNumComma(cards.allTime.cancelled));
                page.dialogs.element.allTimeReturned
                    .text(DBApp.fmtNumComma(cards.allTime.returned));
                page.dialogs.element.allTimeRoyalties
                    .text('$' + DBApp.fmtNumComma(cards.allTime.royalties));

                page.dialogs.element.yesterdayDate.text(cards.yesterday.date);
                page.dialogs.element.yesterdayPurchased
                    .text(DBApp.fmtNumComma(cards.yesterday.purchased));
                page.dialogs.element.yesterdaySold
                    .text(DBApp.fmtNumComma(cards.yesterday.sold));
                page.dialogs.element.yesterdayCancelled
                    .text(DBApp.fmtNumComma(cards.yesterday.cancelled));
                page.dialogs.element.yesterdayReturned
                    .text(DBApp.fmtNumComma(cards.yesterday.returned));
                page.dialogs.element.yesterdayRoyalties
                    .text('$' + DBApp.fmtNumComma(cards.yesterday.royalties));

                page.dialogs.element.lastSevenDaysDate.text(cards.lastSevenDays.date);
                page.dialogs.element.lastSevenDaysPurchased
                    .text(DBApp.fmtNumComma(cards.lastSevenDays.purchased));
                page.dialogs.element.lastSevenDaysSold
                    .text(DBApp.fmtNumComma(cards.lastSevenDays.sold));
                page.dialogs.element.lastSevenDaysCancelled
                    .text(DBApp.fmtNumComma(cards.lastSevenDays.cancelled));
                page.dialogs.element.lastSevenDaysReturned
                    .text(DBApp.fmtNumComma(cards.lastSevenDays.returned));
                page.dialogs.element.lastSevenDaysRoyalties
                    .text('$' + DBApp.fmtNumComma(cards.lastSevenDays.royalties));

                page.dialogs.element.thisMonthDate.text(cards.thisMonth.date);
                page.dialogs.element.thisMonthPurchased
                    .text(DBApp.fmtNumComma(cards.thisMonth.purchased));
                page.dialogs.element.thisMonthSold
                    .text(DBApp.fmtNumComma(cards.thisMonth.sold));
                page.dialogs.element.thisMonthCancelled
                    .text(DBApp.fmtNumComma(cards.thisMonth.cancelled));
                page.dialogs.element.thisMonthReturned
                    .text(DBApp.fmtNumComma(cards.thisMonth.returned));
                page.dialogs.element.thisMonthRoyalties
                    .text('$' + DBApp.fmtNumComma(cards.thisMonth.royalties));

                page.dialogs.element.previousMonthDate.text(cards.previousMonth.date);
                page.dialogs.element.previousMonthPurchased
                    .text(DBApp.fmtNumComma(cards.previousMonth.purchased));
                page.dialogs.element.previousMonthSold
                    .text(DBApp.fmtNumComma(cards.previousMonth.sold));
                page.dialogs.element.previousMonthCancelled
                    .text(DBApp.fmtNumComma(cards.previousMonth.cancelled));
                page.dialogs.element.previousMonthReturned
                    .text(DBApp.fmtNumComma(cards.previousMonth.returned));
                page.dialogs.element.previousMonthRoyalties
                    .text('$' + DBApp.fmtNumComma(cards.previousMonth.royalties));
            })
            .fail((jqXHR) => {
                DBApp.handleFailedTasks(jqXHR);
            })
    }

    /** handle content on page loaded */
    page.commands.handleContentDashboard = (groupId) => {
        let listUserUrl = page.urls.findAmznAccInGrpFilter + groupId;
        let chartDataUrl = page.urls.findChartByGroupId + groupId;
        let cardDataUrl = page.urls.findCardsByGroupId + groupId;
        let tableTodayUrl = page.urls.findAllTodaySoldInGroup + groupId;
        let table30DaysUrl = page.urls.findAllLast30DaysSoldInGroup + groupId;
        let tableThisMonthUrl = page.urls.findAllThisMonthSoldInGroup + groupId;
        let tableAnalyticsUrl = page.urls.findAnalyticsByGroupId + groupId;
        let tableAccDieUrl = page.urls.findAccountDieByGroupId + groupId;

        /** when url does not point to a specific group */
        if (isNaN(groupId) || groupId === '') {
            listUserUrl = page.urls.findAllAmznAccountFilter;
            chartDataUrl = page.urls.findChartAll;
            cardDataUrl = page.urls.findCardsAll;
            tableTodayUrl = page.urls.findAllTodaySoldAllAmznAcc;
            table30DaysUrl = page.urls.findAllLast30DaysSoldAllAmznAcc;
            tableThisMonthUrl = page.urls.findAllThisMonthSoldAllAmznAcc;
            tableAnalyticsUrl = page.urls.findAnalyticsAll;
            tableAccDieUrl = page.urls.findAccountDieAll;
        }

        $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "GET",
            "url": listUserUrl
        })
            .done((accounts) => {
                page.commands.handleFilterDashboard(accounts);
                page.commands.getChart(chartDataUrl);
                page.commands.getCards(cardDataUrl);

                page.element.tableTodaySold.DataTable().ajax.url(tableTodayUrl).load();
                page.element.table30DaysSold.DataTable().ajax.url(table30DaysUrl).load();
                page.element.tableThisMonthSold.DataTable().ajax.url(tableThisMonthUrl).load();

                page.element.tableAnalytics.DataTable().ajax.url(tableAnalyticsUrl).load();
                page.element.tableAccountDie.DataTable().ajax.url(tableAccDieUrl).load();
            })
            .fail((jqXHR) => {
                DBApp.handleFailedTasks(jqXHR);
            })
    }

    /** handle content on-click amzn-user */
    $("#filter-dashboard").on('click', '.list-group-item', function () {
        $("#filter-dashboard .list-group-item").removeClass('active');
        $(this).addClass('active');

        let currentUserId = $(this).data('id');
        let cardDataUrl = page.urls.findCardsByAmznId + currentUserId;
        let chartDataUrl = page.urls.findChartByUserId + currentUserId;
        let tableAnalyticsUrl = page.urls.findAnalyticsByUserId + currentUserId;

        page.commands.getCards(cardDataUrl);
        page.commands.getChart(chartDataUrl);
        getProductSoldDataForEachAmznAcc(currentUserId);
        page.element.tableAnalytics.DataTable().ajax.url(tableAnalyticsUrl).load();
    })

    page.commands.handleFilterDashboard = (accounts) => {
        let container = $('#filter-dashboard');
        let str = ``;

        $.each(accounts, function (index, account) {
            str += `<btn data-id="${account.id}" class="btn list-group-item list-group-item-action">
                        (${account.soldToday}) ${account.username}
                    </btn>`
        })

        container.append(str);
        DBApp.handleFilter('filter-dashboard', 'dashboard-user-search', 'list-group-item');
    }

</script>
</body>

</html>