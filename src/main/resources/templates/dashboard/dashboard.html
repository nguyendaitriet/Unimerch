<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <th:block th:replace="layout/head :: dashboard-head"/>
    <title th:text="#{dashboard.pageTitle}">Dashboard</title>
</head>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <th:block th:replace="layout/sidebar :: sidebar"/>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->
            <th:block th:replace="layout/topbar"/>
            <!-- End of Topbar -->

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="d-sm-flex align-items-center justify-content-between mb-4">
                    <h1 class="h3 mb-0 text-gray-800" th:text="${group.title}">Dashboard</h1>
                    <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                            class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>
                </div>

                <div class="row">
                    <!-- User Filter-->
                    <div class="col-3 col-md-2">
                        <div class="card shadow mb-4">
                            <!-- Card Header -->
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-primary custom-card-title" th:text="${group.title}">Accounts</h6>
                            </div>
                            <div class="input-group input-group-sm mt-2 filter-group">
                                <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="fas fa-filter"></i>
                                        </span>
                                </div>
                                <input id="dashboard-user-search" class="form-control" type="text"
                                       placeholder="Find...">
                            </div>

                            <div class="scrollbar-user bg-white mt-2 custom-scrollbar">
                                <ul id="filter-dashboard" class="list-group">
                                    <!-- User Items -->

                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="col-9 col-md-10">
                        <div class="card shadow mb-4">
                            <!-- Card Header -->
                            <ul class="card-header nav nav-tabs custom-nav" role="tablist">
                                <li class="nav-item">
                                    <a class="m-0 font-weight-bold text-primary nav-link active custom-card-title"
                                       data-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard"
                                       aria-selected="true">Dashboard</a>
                                </li>
                                <li class="nav-item">
                                    <a class="m-0 font-weight-bold text-primary nav-link custom-card-title"
                                       data-toggle="tab" href="#analytics" role="tab" aria-controls="analytics"
                                       aria-selected="false">Analytics</a>
                                </li>
                                <li class="nav-item">
                                    <a class="m-0 font-weight-bold text-primary nav-link custom-card-title"
                                       data-toggle="tab" href="#accountdie" role="tab" aria-controls="accountdie"
                                       aria-selected="false">Account Die</a>
                                </li>
                            </ul>

                            <div class="card-body tab-content">
                                <!-- Card Body -- Dashboard -->
                                <div class="tab-pane fade show active" id="dashboard" role="tabpanel"
                                     aria-labelledby="dashboard-tab">

                                    <div class="row flex-md-row-reverse">
                                        <!-- Chart -->
                                        <div class="col-lg-8 col-md-12 mb-4">
                                            <div class="row" id="chartHolder" style="height:380px; width:100%;"></div>
                                            <div class="row mt-4 text-center justify-content-center small">
                                                    <span class="mr-4">
                                                        <i class="fas fa-square text-primary"></i><br> Royalties
                                                    </span>
                                                <span class="mr-4">
                                                        <i class="fas fa-square text-success"></i><br> Number Sold
                                                    </span>
                                            </div>
                                        </div>

                                        <!-- Today's sale -->
                                        <div class="col-lg-4 col-md-12 my-4 mt-md-5">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2">
                                                        <div class="col mr-2">
                                                            <div class="text-center font-weight-bold text-primary text-uppercase">
                                                                Today's Sale
                                                                <br>
                                                                (29/08/2022)
                                                            </div>

                                                            <hr class="sidebar-divider my-2">

                                                            <div class="h2 text-center mb-0 font-weight-bold text-gray-800">
                                                                40,000
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row mt-1 no-gutters d-flex justify-content-between">
                                                        <div>
                                                            100/10
                                                        </div>
                                                        <div>
                                                            Sold/Cancelled
                                                        </div>
                                                    </div>
                                                    <div class="row mt-1 no-gutters d-flex justify-content-between">
                                                        <div>
                                                            40
                                                        </div>
                                                        <div>
                                                            Returned
                                                        </div>
                                                    </div>
                                                    <div class="row mt-1 no-gutters d-flex justify-content-between">
                                                        <div>
                                                            $1234.0
                                                        </div>
                                                        <div>
                                                            Royalties
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row justify-content-center">
                                        <!-- 1st card sale -->
                                        <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2 custom-card-header">
                                                        <div class="col mr-2">
                                                            <div class="h6 text-center font-weight-bold text-primary text-uppercase">
                                                                All Times
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr class="sidebar-divider my-2">

                                                    <div class="row">
                                                        <div class="col-6 d-flex flex-row justify-content-center align-items-center">
                                                            <div class="h3 mb-0 text-gray-800">
                                                                40,000
                                                            </div>
                                                        </div>

                                                        <div class="col">
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                100/10
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                40
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                $1234.0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 2nd card sale -->
                                        <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2 custom-card-header">
                                                        <div class="col mr-2">
                                                            <div class="h6 text-center font-weight-bold text-primary text-uppercase">
                                                                Yesterday
                                                                <br>
                                                                (00/00/0000)
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr class="sidebar-divider my-2">

                                                    <div class="row">
                                                        <div class="col-6 d-flex flex-row justify-content-center align-items-center">
                                                            <div class="h3 mb-0 text-gray-800">
                                                                40,000
                                                            </div>
                                                        </div>

                                                        <div class="col">
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                100/10
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                40
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                $1234.0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 3rd card sale -->
                                        <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2 custom-card-header">
                                                        <div class="col mr-2">
                                                            <div class="h6 text-center font-weight-bold text-primary text-uppercase">
                                                                Last 7 Days
                                                                <br>
                                                                (00/00/0000)
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr class="sidebar-divider my-2">

                                                    <div class="row">
                                                        <div class="col-6 d-flex flex-row justify-content-center align-items-center">
                                                            <div class="h3 mb-0 text-gray-800">
                                                                40,000
                                                            </div>
                                                        </div>

                                                        <div class="col">
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                100/10
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                40
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                $1234.0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 4th card sale -->
                                        <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2 custom-card-header">
                                                        <div class="col mr-2">
                                                            <div class="h6 text-center font-weight-bold text-primary text-uppercase">
                                                                This Month
                                                                <br>
                                                                (00/00/0000)
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr class="sidebar-divider my-2">

                                                    <div class="row">
                                                        <div class="col-6 d-flex flex-row justify-content-center align-items-center">
                                                            <div class="h3 mb-0 text-gray-800">
                                                                40,000
                                                            </div>
                                                        </div>

                                                        <div class="col">
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                100/10
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                40
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                $1234.0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 5th card sale -->
                                        <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
                                            <div class="card border-left-primary shadow">
                                                <div class="card-body">
                                                    <div class="row no-gutters align-items-center mb-2 custom-card-header">
                                                        <div class="col mr-2">
                                                            <div class="h6 text-center font-weight-bold text-primary text-uppercase">
                                                                Previous Month
                                                                <br>
                                                                (00/00/0000)
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr class="sidebar-divider my-2">

                                                    <div class="row">
                                                        <div class="col-6 d-flex flex-row justify-content-center align-items-center">
                                                            <div class="h3 mb-0 text-gray-800">
                                                                40,000
                                                            </div>
                                                        </div>

                                                        <div class="col">
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                100/10
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                40
                                                            </div>
                                                            <div class="row mt-1 no-gutters d-flex justify-content-end">
                                                                $1234.0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <!-- Table Orders -->
                                    <ul class="card-header nav nav-tabs custom-nav" role="tablist">
                                        <li class="nav-item">
                                            <a class="m-0 font-weight-bold text-primary nav-link active custom-card-title"
                                               data-toggle="tab" href="#today" role="tab" aria-controls="today"
                                               aria-selected="true">Today</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="m-0 font-weight-bold text-primary nav-link custom-card-title"
                                               data-toggle="tab" href="#thirtyday" role="tab" aria-controls="thirtyday"
                                               aria-selected="false">30 Days</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="m-0 font-weight-bold text-primary nav-link custom-card-title"
                                               data-toggle="tab" href="#thismonth" role="tab" aria-controls="thismonth"
                                               aria-selected="false">This month</a>
                                        </li>
                                    </ul>

                                    <div class="card-body tab-content">
                                        <!-- Table - Today -->
                                        <div class="tab-pane fade show active" id="today" role="tabpanel"
                                             aria-labelledby="today-tab">
                                            <table>
                                                <thead>
                                                <tr>
                                                    <th>Sold</th>
                                                    <th>Product</th>
                                                    <th>Royalties</th>
                                                    <th>Price</th>
                                                    <th>User</th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                        <!-- Table - 30 Days -->
                                        <div class="tab-pane fade show" id="thirtyday" role="tabpanel"
                                             aria-labelledby="thirtyday-tab">
                                            <table>
                                                <thead>
                                                <tr>
                                                    <th>Sold</th>
                                                    <th>Product</th>
                                                    <th>Royalties</th>
                                                    <th>Price</th>
                                                    <th>User</th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                        <!-- Table - This month -->
                                        <div class="tab-pane fade show" id="thismonth" role="tabpanel"
                                             aria-labelledby="thismonth-tab">
                                            <table>
                                                <thead>
                                                <tr>
                                                    <th>Sold</th>
                                                    <th>Product</th>
                                                    <th>Royalties</th>
                                                    <th>Price</th>
                                                    <th>User</th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- Card Body -- Analytics -->
                                <div class="tab-pane fade" id="analytics" role="tabpanel"
                                     aria-labelledby="analytics-tab">
                                    <table>
                                        <thead>
                                        <tr>
                                            <th>User</th>
                                            <th>Published</th>
                                            <th>Tier</th>
                                            <th>Slot Remaining</th>
                                            <th>Slot Total</th>
                                            <th>Reject</th>
                                            <th>Remove</th>
                                            <th>Sales</th>
                                            <th>Note</th>
                                        </tr>
                                        </thead>
                                    </table>
                                </div>

                                <!-- Card Body -- Account Die -->
                                <div class="tab-pane fade" id="accountdie" role="tabpanel"
                                     aria-labelledby="accountdie-tab">
                                    <table>
                                        <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Email</th>
                                            <th>Last Update</th>
                                            <th>Account Status</th>
                                        </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <th:block th:replace="layout/footer :: footer"/>
        <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>

<th:block th:replace="layout/script :: script-dashboard"/>

<script>
    let currentGrpId = window.location.pathname.split('/')[2];
    console.log(currentGrpId);

    let page = {
        urls: {
            findAllAmznAccount: App.BASE_URL_AMZN_ACCOUNT + "/findAll",
            findAmznAccInGrp: App.BASE_URL_GROUP + "/showAmznAccInsideGroup/",
        },
        element: {},
        commands: {},
        dialogs: {
            element: {},
            alertDanger: {},
            inputError: {}
        }
    }

    var navBar = $("#topNav");
    var hdrHeight = $("header").height();


    $(window).scroll(function () {
        if ($(this).scrollTop() > hdrHeight + 50) {
            navBar.addClass("navScrolled");
        } else {
            navBar.removeClass("navScrolled");
        }
    });

    var chartVars = "KoolOnLoadCallFunction=chartReadyHandler";

    KoolChart.create("chart1", "chartHolder", chartVars, "100%", "100%");

    function chartReadyHandler(id) {
        $('#' + id)[0].setLayout(layoutStr);
        $('#' + id)[0].setData(chartData);
    }

    var layoutStr =
        `<KoolChart backgroundColor="#FFFFFF"  borderStyle="none">'
                +'<Options>'
                    +'<Caption text="Revenues Dashboard" fontSize="20"/>'
                +'</Options>'

                +'<NumberFormatter id="numfmt" useThousandsSeparator="true"/>'

                +'<Combination2DChart showDataTips="true">'
                    +'<horizontalAxis>'
                        +'<CategoryAxis categoryField="Month" padding="1"/>'
                    +'</horizontalAxis>'

                    +'<verticalAxis>'
                        +'<LinearAxis id="vAxis1" formatter="{numfmt}" maximum="100" interval="10"/>'
                    +'</verticalAxis>'

                    +'<series>'
                        +'<Column2DSeries labelPosition="outside" yField="Profit" displayName="Profit" showValueLabels="[5]" columnWidthRatio="0.54">'
                            +'<fill>'
                                +'<SolidColor color="#41b2e6"/>'
                            +'</fill>'
                            +'<showDataEffect>'
                                +'<SeriesInterpolate/>'
                            +'</showDataEffect>'
                        +'</Column2DSeries>'

                        +'<Line2DSeries radius="6" yField="Cost" displayName="Cost" itemRenderer="CircleItemRenderer">'
                            +'<verticalAxis>'
                                +'<LinearAxis id="vAxis2" interval="40" maximum="320"/>'
                            +'</verticalAxis>'
                            +'<showDataEffect>'
                                +'<SeriesInterpolate/>'
                            +'</showDataEffect>'
                            +'<lineStroke>'
                                +'<Stroke color="#f9bd03" weight="4"/>'
                            +'</lineStroke>'
                            +'<stroke>'
                                +'<Stroke color="#f9bd03" weight="3"/>'
                            +'</stroke>'
                        +'</Line2DSeries>'
                    +'</series>'

                    +'<verticalAxisRenderers>'
                        +'<Axis2DRenderer axis="{vAxis1}" showLine="false"/>'
                        +'<Axis2DRenderer axis="{vAxis2}" showLine="false"/>'
                    +'</verticalAxisRenderers>'
                +'</Combination2DChart>'
            +'</KoolChart>`;

    var chartData = [
        {"Month": "Jan", "Profit": 20, "Cost": 120, "Revenue": 2300},
        {"Month": "Feb", "Profit": 30, "Cost": 160, "Revenue": 1200},
        {"Month": "Mar", "Profit": 52, "Cost": 150, "Revenue": 1600},
        {"Month": "Apr", "Profit": 45, "Cost": 190, "Revenue": 1300},
        {"Month": "May", "Profit": 62, "Cost": 180, "Revenue": 1000},
        {"Month": "Jun", "Profit": 82, "Cost": 250, "Revenue": 1200},
        {"Month": "Oct", "Profit": 42, "Cost": 120, "Revenue": 1000}
    ];

    function handleFilterDashboard(groupId) {
        let container = $('#filter-dashboard');

        let url = page.urls.findAmznAccInGrp + groupId;

        if (groupId === undefined) {
            url = page.urls.findAllAmznAccount;
        }

        $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "GET",
            "url": url,
        })
            .done((accounts) => {
                console.log(accounts);
                let str = ``;

                $.each(accounts, function (index, account) {
                    str += `<li class="list-group-item">${account.username}</li>`
                })

                container.append(str);
                App.handleFilter('filter-dashboard', 'dashboard-user-search', 'list-group-item');
            })
            .fail((jqXHR) => {
                alert("fail");
            })
    }

    handleFilterDashboard(currentGrpId);
</script>
</body>

</html>